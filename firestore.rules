rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only read/write their own data.
    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;
    }

    // Leads can be read/written by the user who owns them.
    match /leads/{leadId} {
      allow read, write: if request.auth.uid == resource.data.userId;
    }

    // Targets can be read/written by the user who owns them.
    match /targets/{targetId} {
      allow read, write: if request.auth.uid == resource.data.userId;
    }

    // Actions can be read/written by the user who owns them.
    match /actions/{actionId} {
        allow read, write: if request.auth.uid == resource.data.userId;
    }

    // The workers collection is admin-only.
    // This assumes an 'isAdmin' flag on the user's document.
    match /workers/{workerId} {
      allow read, write: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.isAdmin == true;
    }
  }
}